@import models._
@import extentions.MDLForms._

@(currentUser: User)(form: Form[(List[csv.Section], java.util.UUID)], existingUsers: List[User])(implicit webJarsUtil: org.webjars.play.WebJarsUtil, flash: Flash, messagesProvider: MessagesProvider, request: RequestHeader)

@display(section: Field, sectionIndex: Int)(header: Html)(footer: Html) = {
<table class="mdl-cell mdl-cell--12-col mdl-data-table mdl-js-data-table pem-table mdl-shadow--2dp mdl-color--white">
  <thead>
    <tr style="background-color: lightblue">
      @header
    </tr>
  </thead>
  <tbody>
    @helper.repeatWithIndex(section("users")) { (user, index) =>
    <tr class="searchable-row td--clear-border" id="line_@{sectionIndex}_@{index}">
      <td class="mdl-data-table__cell--non-numeric cell-import-user">
        @helper.input(user("id"), 'label -> "Id", 'class -> "hidden input-import-user") { (id, name, value, args) =>
          <input class="mdl-textfield__input input-import-user" type="text" name="@name" id="@id" value="@value" @toHtmlArgs(args)>
        }
        @helper.input(user(csv.USER_LAST_NAME.key), 'label -> "Nom et prénom", 'class -> "input-import-user") { (id, name, value, args) =>
          <input class="mdl-textfield__input input-import-user" type="text" name="@name" id="@id" value="@value" @toHtmlArgs(args)>
        }
      </td>
      <td class="mdl-data-table__cell--non-numeric cell-import-user">
        @helper.input(user(csv.USER_EMAIL.key), 'label -> "Email", 'class -> "input-import-user") { (id, name, value, args) =>
          <input class="mdl-textfield__input input-import-user" type="text" name="@name" id="@id" value="@value" @toHtmlArgs(args)>
        }
      </td>
      <td class="mdl-data-table__cell--non-numeric cell-import-user">
        @helper.input(user(csv.USER_PHONE_NUMBER.key), 'label -> "Numéro de téléphone", 'class -> "input-import-user") { (id, name, value, args) =>
        <input class="mdl-textfield__input input-import-user" type="text" name="@name" id="@id" value="@value" @toHtmlArgs(args)>
        }
      </td>
      <td class="mdl-data-table__cell--non-numeric cell-import-user">
        @helper.checkbox(user(csv.INSTRUCTOR.key), 'type -> "checkbox", 'label -> csv.INSTRUCTOR.prefixes(0), 'class -> "mdl-checkbox__input instructor")
      </td>
      <td class="mdl-data-table__cell--non-numeric cell-import-user">
        @helper.checkbox(user(csv.GROUP_MANAGER.key), 'type -> "checkbox", 'label -> csv.GROUP_MANAGER.prefixes(0), 'class -> "mdl-checkbox__input")
      </td>
      <td>
        <input type="button" class="delete-line" data-line-id="line_@{sectionIndex}_@{index}" value="Supprimer la ligne">
      </td>
    </tr>
    }
  </tbody>
</table>
}

@main(currentUser)("Revue de votre import CSV") {
  <script src='@routes.Assets.versioned("javascripts/main.js")'></script>
  <script src='@routes.Assets.versioned("javascripts/csv-import.js")'></script>
} {
  @helper.form(routes.UserController.importUsers(), 'method -> "post", 'class -> "mdl-cell mdl-cell--12-col") {
  @helper.CSRF.formField
    @if(form.hasGlobalErrors) {
      @for(error <- form.globalErrors) {
        @for(args <- error.args) {
          <div style="color: red; font-weight: bold;">
            <p>@args.asInstanceOf[Tuple2[String,String]]._1</p>
            <p>@args.asInstanceOf[Tuple2[String,String]]._2</p>
          </div>
          <br>
        }
      }
    }
  <div>
    @if(existingUsers.nonEmpty) {
      Utilisateurs dont le compte existe déjà :
      <ul>
        @for(existingUser <- existingUsers) {
          <li><a href="/utilisateurs/@existingUser.id">@existingUser.name (@existingUser.email)</a></li>
        }
      </ul>
    }
    <input type="hidden" id="area-selector" name="area-selector" value="@form("area-selector").value" />
  </div>
    <em>Instructeur : </em><a href="#" id="instructor-all-link">Tous</a> / <a href="#" id="instructor-none-link">Aucuns</a>
    @helper.repeatWithIndex(form("sections")) { (section, sectionIndex) =>
        @display(section, sectionIndex) {
            <th class="mdl-data-table__cell--non-numeric mdl-data-table--th--nopadding" colspan="1">
              @helper.input(section("group")("id"), 'label -> "Id", 'class -> "hidden input-import-user") { (id, name, value, args) =>
              <input class="mdl-textfield__input input-import-user" type="text" name="@name" id="@id" value="@value" @toHtmlArgs(args)>
              }
              @helper.input(section("group")(csv.GROUP_NAME.key), 'label -> csv.GROUP_NAME.prefixes(0), 'class -> "input-import-user") { (id, name, value, args) =>
                <input class="mdl-textfield__input input-import-user" type="text" name="@name" id="@id" value="@value" @toHtmlArgs(args)>
              }
            </th>
            <th class="mdl-data-table__cell--non-numeric mdl-data-table--th--nopadding" colspan="2">
              @helper.input(section("group")(csv.GROUP_ORGANISATION.key), 'label -> csv.GROUP_ORGANISATION.prefixes(0), 'class -> "input-import-user") { (id, name, value, args) =>
                <input class="mdl-textfield__input input-import-user" type="text" name="@name" id="@id" value="@value" @toHtmlArgs(args)>
              }
            </th>
            <th class="mdl-data-table__cell--non-numeric mdl-data-table--th--nopadding" colspan="2">
              @helper.input(section("group")(csv.GROUP_EMAIL.key), 'label -> csv.GROUP_EMAIL.prefixes(0), 'class -> "input-import-user") { (id, name, value, args) =>
                <input class="mdl-textfield__input input-import-user" type="text" name="@name" id="@id" value="@value" @toHtmlArgs(args)>
              }
            </th>
            <th>
              @helper.input(section("group")(csv.GROUP_AREAS.key), 'label -> "Territoires", 'class -> "input-import-user") { (id, name, value, args) =>
                <input class="mdl-textfield__input input-import-user" type="text" name="@name" readonly id="@id" value="@value" @toHtmlArgs(args)>
              }
            </th>
        } { }
    }
    <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-cell" onsubmit="Main.disableEventTarget(this)">Importer</button>
  }
}